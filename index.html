<!doctype html>
<html lang="pt-br">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Calculadora de Taxas</title>

<style>
body{font-family:Arial;background:#f5f6fa;padding:20px}
.container{max-width:1100px;margin:auto}
.card{background:white;padding:20px;border-radius:15px;box-shadow:0 8px 20px rgba(0,0,0,0.08);margin-bottom:20px}
h1{margin-bottom:10px}
input{width:100%;padding:12px;border-radius:10px;border:1px solid #ddd;font-size:16px}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:20px}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{padding:8px;border-bottom:1px solid #eee;text-align:left}
th{background:#eef2ff}
@media(max-width:900px){.grid{grid-template-columns:1fr}}
</style>
</head>

<body>
<div class="container">

<div class="card">
<h1>Calculadora de Taxas</h1>
<label>Valor à vista (R$)</label>
<input type="number" id="valor" step="0.01" placeholder="Ex: 1000">
</div>

<div class="grid">
<div class="card">
<h2>Máquina Física</h2>
<div id="maquina"></div>
</div>

<div class="card">
<h2>Link de Pagamento</h2>
<div id="link"></div>
</div>
</div>

</div>

<script>
// ===== TAXAS =====
const MAQUINA = {
  debito: 1.30,
  credito: {
    1:3.69,2:5.19,3:5.95,4:6.70,5:7.65,6:8.55,
    7:9.40,8:10.30,9:11.20,10:12.10,11:13.10,
    12:13.90,13:15.70,14:16.80,15:17.90,
    16:18.80,17:19.01,18:19.90
  }
};

const LINK = {
  credito: {
    1:6.50,2:9.55,3:10.40,4:11.30,5:12.20,
    6:13.10,7:14.00,8:15.90,9:16.80,
    10:17.50,11:18.60,12:19.50
  }
};

// ===== HELPERS =====
function formatar(v){
  return v.toLocaleString("pt-BR",{style:"currency",currency:"BRL"});
}

// Aceita "1000", "1000.50" e "1000,50"
function lerValor() {
  const raw = (document.getElementById("valor").value || "").trim();
  if (!raw) return null;
  const normalizado = raw.replace(/\./g, "").replace(",", "."); // tira milhar e troca vírgula por ponto
  const v = Number(normalizado);
  return Number.isFinite(v) && v > 0 ? v : null;
}

function linha(parcelasLabel, taxaPercent, valorFinal, parcela){
  const parcelaTxt = parcela == null ? "-" : formatar(parcela);
  return `
    <tr>
      <td>${parcelasLabel}</td>
      <td>${taxaPercent.toFixed(2)}%</td>
      <td>${formatar(valorFinal)}</td>
      <td>${parcelaTxt}</td>
    </tr>
  `;
}

function montarTabela(linhasHtml){
  return `
    <table>
      <thead>
        <tr>
          <th>Parcelas</th>
          <th>Taxa</th>
          <th>Valor Final</th>
          <th>Parcela</th>
        </tr>
      </thead>
      <tbody>
        ${linhasHtml}
      </tbody>
    </table>
  `;
}

function atualizar(){
  const alvoMaquina = document.getElementById("maquina");
  const alvoLink = document.getElementById("link");
  const valor = lerValor();

  if (!alvoMaquina || !alvoLink) return;

  if (!valor){
    alvoMaquina.innerHTML = "<p>Digite um valor acima.</p>";
    alvoLink.innerHTML = "<p>Digite um valor acima.</p>";
    return;
  }

  // ---- Máquina (Débito + Crédito)
  let linhasM = "";
  // Débito (embutindo taxa)
  const tDeb = MAQUINA.debito / 100;
  const valorFinalDeb = valor / (1 - tDeb);
  linhasM += linha("Débito", MAQUINA.debito, valorFinalDeb, null);

  // Crédito
  Object.keys(MAQUINA.credito).map(Number).sort((a,b)=>a-b).forEach(p=>{
    const taxa = MAQUINA.credito[p];
    const t = taxa / 100;
    const valorFinal = valor / (1 - t);
    const parc = valorFinal / p;
    linhasM += linha(`${p}x`, taxa, valorFinal, parc);
  });

  alvoMaquina.innerHTML = montarTabela(linhasM);

  // ---- Link (Crédito)
  let linhasL = "";
  Object.keys(LINK.credito).map(Number).sort((a,b)=>a-b).forEach(p=>{
    const taxa = LINK.credito[p];
    const t = taxa / 100;
    const valorFinal = valor / (1 - t);
    const parc = valorFinal / p;
    linhasL += linha(`${p}x`, taxa, valorFinal, parc);
  });

  alvoLink.innerHTML = montarTabela(linhasL);
}

document.addEventListener("DOMContentLoaded", () => {
  const el = document.getElementById("valor");
  if (el) el.addEventListener("input", atualizar);
  atualizar(); // render inicial
});
</script>
