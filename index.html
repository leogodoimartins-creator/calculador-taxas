<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calculadora de Taxas</title>

  <style>
    body{font-family:Arial,Helvetica,sans-serif;background:#f5f6fa;padding:20px;margin:0}
    .container{max-width:1100px;margin:auto}
    .card{background:white;padding:20px;border-radius:15px;box-shadow:0 8px 20px rgba(0,0,0,0.08);margin-bottom:20px}
    h1{margin:0 0 10px 0}
    p{margin:0 0 16px 0;color:#555}
    label{display:block;margin:10px 0 6px 0;font-size:13px;color:#222}
    input{width:100%;padding:12px;border-radius:10px;border:1px solid #ddd;font-size:16px;outline:none}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:20px}
    table{width:100%;border-collapse:collapse;margin-top:10px}
    th,td{padding:10px;border-bottom:1px solid #eee;text-align:left;font-size:14px}
    th{background:#eef2ff;color:#1f2a6a}
    .hint{font-size:12px;color:#666;margin-top:8px}
    @media(max-width:900px){.grid{grid-template-columns:1fr}}

    /* Accordion */
    details.accordion{border:1px solid #e5e7eb;border-radius:14px;overflow:hidden}
    details.accordion > summary{
      list-style:none; cursor:pointer; padding:14px 16px; background:#f9fafb;
      display:flex; align-items:center; justify-content:space-between; font-weight:700
    }
    details.accordion > summary::-webkit-details-marker{display:none}
    .chev{transition:transform .2s ease}
    details[open] .chev{transform:rotate(180deg)}
    .acc-body{padding:16px}
    .btn{width:100%;margin-top:10px;padding:12px;border:0;border-radius:12px;background:#2563eb;color:#fff;font-weight:700;font-size:14px;cursor:pointer}
    .btn-dark{background:#111827}
    .err{margin-top:10px;color:#b91c1c;font-size:13px}
  </style>
</head>

<body>
  <div class="container">

    <div class="card">
      <h1>Calculadora de Taxas</h1>
      <p>Digite o <strong>valor à vista</strong>. A tabela mostra o <strong>valor final</strong> (com taxa embutida) e a <strong>parcela</strong>.</p>

      <label for="valor">Valor à vista (R$)</label>
      <input type="text" id="valor" placeholder="Ex: 1000 ou 1000,50" />
      <div class="hint">Você pode digitar com vírgula (ex: 1000,50). Não use símbolo R$.</div>
    </div>

    <div class="grid">
      <div class="card">
        <h2 style="margin:0">Máquina Física</h2>
        <div id="maquina" style="margin-top:10px;">Digite um valor acima.</div>
      </div>

      <div class="card">
        <h2 style="margin:0">Link de Pagamento</h2>
        <div id="link" style="margin-top:10px;">Digite um valor acima.</div>
      </div>
    </div>

    <!-- Accordion 1 -->
    <div class="card" style="margin-top:20px;">
      <details class="accordion" id="advAccordion">
        <summary>
          Área Avançada (Valor que recebe após taxa extra) <span class="chev">▾</span>
        </summary>

        <div class="acc-body">
          <p style="margin:0 0 12px;color:#555">
            Aqui mostramos apenas <strong>Parcelas</strong> e <strong>Valor que recebe</strong>,
            calculado como:<br>
            <strong>Valor que recebe</strong> = <em>Valor Final (tabela de cima)</em> − <em>(Valor Final × taxa extra)</em>
          </p>

          <div id="lockBox">
            <label for="pin">Senha</label>
            <input id="pin" type="password" placeholder="Digite a senha" />
            <button class="btn" id="btnUnlock">Desbloquear</button>
            <div class="err" id="lockMsg"></div>
            <div class="hint">Obs: trava visual (site estático).</div>
          </div>

          <div id="advancedBox" style="display:none;margin-top:14px;">
            <div class="grid">
              <div>
                <h3 style="margin:0 0 8px;font-size:15px;">Máquina Física (valor que recebe)</h3>
                <div id="maquinaExtra"></div>
              </div>
              <div>
                <h3 style="margin:0 0 8px;font-size:15px;">Link de Pagamento (valor que recebe)</h3>
                <div id="linkExtra"></div>
              </div>
            </div>

            <button class="btn btn-dark" id="btnLock">Bloquear</button>
          </div>
        </div>
      </details>
    </div>

    <!-- Accordion 2 (novo) -->
    <div class="card" style="margin-top:20px;">
      <details class="accordion" id="discountAccordion">
        <summary>
          Descontar taxas (Máquina + Link) em cima de um valor <span class="chev">▾</span>
        </summary>

        <div class="acc-body">
          <p style="margin:0 0 12px;color:#555">
            Digite um valor abaixo. A tabela calcula quanto você recebe ao <strong>descontar</strong> as taxas
            usando as mesmas porcentagens da taxa extra.<br>
            <strong>Valor que recebe</strong> = <em>Valor digitado</em> − <em>(Valor digitado × taxa%)</em>
          </p>

          <div id="lockBox2">
            <label for="pin2">Senha</label>
            <input id="pin2" type="password" placeholder="Digite a senha" />
            <button class="btn" id="btnUnlock2">Desbloquear</button>
            <div class="err" id="lockMsg2"></div>
            <div class="hint">Obs: trava visual (site estático).</div>
          </div>

          <div id="discountBox2" style="display:none;margin-top:14px;">
            <label for="valor2">Valor (R$)</label>
            <input type="text" id="valor2" placeholder="Ex: 1000 ou 1000,50" />
            <div class="hint">Esse valor é independente do valor à vista de cima.</div>

            <div class="grid" style="margin-top:12px;">
              <div>
                <h3 style="margin:0 0 8px;font-size:15px;">Máquina (valor que recebe após desconto)</h3>
                <div id="maquinaDesconto"></div>
              </div>
              <div>
                <h3 style="margin:0 0 8px;font-size:15px;">Link (valor que recebe após desconto)</h3>
                <div id="linkDesconto"></div>
              </div>
            </div>

            <button class="btn btn-dark" id="btnLock2">Bloquear</button>
          </div>
        </div>
      </details>
    </div>

  </div>

<script>
  // TAXAS PRINCIPAIS (tabela de cima)
  const MAQUINA = {
    debito: 1.30,
    credito: {
      1: 3.69, 2: 5.19, 3: 5.95, 4: 6.70, 5: 7.65, 6: 8.55,
      7: 9.40, 8: 10.30, 9: 11.20, 10: 12.10, 11: 13.10, 12: 13.90,
      13: 15.70, 14: 16.80, 15: 17.90, 16: 18.80, 17: 19.01, 18: 19.90
    }
  };

  const LINK = {
    credito: {
      1: 6.50, 2: 9.55, 3: 10.40, 4: 11.30, 5: 12.20, 6: 13.10,
      7: 14.00, 8: 15.90, 9: 16.80, 10: 17.50, 11: 18.60, 12: 19.50
    }
  };

  // TAXAS EXTRAS (percentuais)
  const EXTRA_MAQUINA = {
    0: 0.99,
    1: 3.39, 2: 4.40, 3: 5.40, 4: 5.70, 5: 5.80, 6: 5.99,
    7: 7.20, 8: 7.90, 9: 8.40, 10: 8.85, 11: 9.40, 12: 9.85,
    13: 11.40, 14: 11.90, 15: 12.75, 16: 12.80, 17: 12.85, 18: 12.90
  };

  const EXTRA_LINK = {
    1: 3.49, 2: 4.85, 3: 5.45, 4: 6.05, 5: 6.45, 6: 6.95,
    7: 8.00, 8: 8.60, 9: 9.10, 10: 9.40, 11: 10.20, 12: 10.75
  };

  // SENHA (ambas iguais)
  const PIN_VALUE = "358000";

  // Persistência separada
  const ADV_KEY_1 = "adv_unlocked_v2";
  const ADV_KEY_2 = "disc_unlocked_v2";

  // Helpers
  function formatar(v){
    return v.toLocaleString("pt-BR",{style:"currency",currency:"BRL"});
  }

  function parseBRL(raw) {
    const t = (raw || "").trim();
    if (!t) return null;
    const normalizado = t.replace(/\./g, "").replace(",", ".");
    const v = Number(normalizado);
    return Number.isFinite(v) && v > 0 ? v : null;
  }

  function lerValor() { return parseBRL(document.getElementById("valor").value); }
  function lerValor2() { return parseBRL(document.getElementById("valor2").value); }

  function valorFinalEmbutido(valorAvista, taxaPercent){
    const t = taxaPercent / 100;
    return valorAvista / (1 - t);
  }

  function montarTabela4(linhasHtml){
    return `
      <table>
        <thead>
          <tr>
            <th>Parcelas</th>
            <th>Taxa</th>
            <th>Valor Final</th>
            <th>Parcela</th>
          </tr>
        </thead>
        <tbody>${linhasHtml}</tbody>
      </table>
    `;
  }

  function linha4(parcelasLabel, taxaPercent, valorFinal, parcela){
    const parcelaTxt = parcela == null ? "-" : formatar(parcela);
    return `
      <tr>
        <td>${parcelasLabel}</td>
        <td>${taxaPercent.toFixed(2)}%</td>
        <td>${formatar(valorFinal)}</td>
        <td>${parcelaTxt}</td>
      </tr>
    `;
  }

  function montarTabela2(linhasHtml){
    return `
      <table>
        <thead>
          <tr>
            <th>Parcelas</th>
            <th>Valor que recebe</th>
          </tr>
        </thead>
        <tbody>${linhasHtml}</tbody>
      </table>
    `;
  }

  function linha2(parcelasLabel, valorRecebe){
    return `
      <tr>
        <td>${parcelasLabel}</td>
        <td><strong>${formatar(valorRecebe)}</strong></td>
      </tr>
    `;
  }

  function taxaExtra(obj, key){
    const v = obj[key];
    return (typeof v === "number" && isFinite(v)) ? v : 0;
  }

  // Tabelas principais (de cima)
  function atualizar(){
    const alvoMaquina = document.getElementById("maquina");
    const alvoLink = document.getElementById("link");
    const valor = lerValor();

    if (!valor){
      alvoMaquina.innerHTML = "Digite um valor acima.";
      alvoLink.innerHTML = "Digite um valor acima.";
      renderAvancado(null);
      return;
    }

    let linhasM = "";
    const vfDeb = valorFinalEmbutido(valor, MAQUINA.debito);
    linhasM += linha4("Débito", MAQUINA.debito, vfDeb, null);

    Object.keys(MAQUINA.credito).map(Number).sort((a,b)=>a-b).forEach(p=>{
      const taxa = MAQUINA.credito[p];
      const vf = valorFinalEmbutido(valor, taxa);
      const parc = vf / p;
      linhasM += linha4(`${p}x`, taxa, vf, parc);
    });
    alvoMaquina.innerHTML = montarTabela4(linhasM);

    let linhasL = "";
    Object.keys(LINK.credito).map(Number).sort((a,b)=>a-b).forEach(p=>{
      const taxa = LINK.credito[p];
      const vf = valorFinalEmbutido(valor, taxa);
      const parc = vf / p;
      linhasL += linha4(`${p}x`, taxa, vf, parc);
    });
    alvoLink.innerHTML = montarTabela4(linhasL);

    renderAvancado(valor);
  }

  // Accordion 1
  function renderAvancado(valorAvista){
    const boxM = document.getElementById("maquinaExtra");
    const boxL = document.getElementById("linkExtra");
    if (!isUnlocked1()) return;

    if (!valorAvista){
      boxM.innerHTML = "<p>Digite um valor acima.</p>";
      boxL.innerHTML = "<p>Digite um valor acima.</p>";
      return;
    }

    let linhasM = "";
    {
      const vf = valorFinalEmbutido(valorAvista, MAQUINA.debito);
      const te = taxaExtra(EXTRA_MAQUINA, 0);
      const recebe = vf - (vf * (te/100));
      linhasM += linha2("Débito", recebe);
    }
    Object.keys(MAQUINA.credito).map(Number).sort((a,b)=>a-b).forEach(p=>{
      const vf = valorFinalEmbutido(valorAvista, MAQUINA.credito[p]);
      const te = taxaExtra(EXTRA_MAQUINA, p);
      const recebe = vf - (vf * (te/100));
      linhasM += linha2(`${p}x`, recebe);
    });
    boxM.innerHTML = montarTabela2(linhasM);

    let linhasL = "";
    Object.keys(LINK.credito).map(Number).sort((a,b)=>a-b).forEach(p=>{
      const vf = valorFinalEmbutido(valorAvista, LINK.credito[p]);
      const te = taxaExtra(EXTRA_LINK, p);
      const recebe = vf - (vf * (te/100));
      linhasL += linha2(`${p}x`, recebe);
    });
    boxL.innerHTML = montarTabela2(linhasL);
  }

  // Accordion 2 (novo) - Máquina + Link sobre valor2
  function renderDesconto2(){
    if (!isUnlocked2()) return;

    const valor = lerValor2();
    const boxM = document.getElementById("maquinaDesconto");
    const boxL = document.getElementById("linkDesconto");

    if (!valor){
      boxM.innerHTML = "<p>Digite um valor acima.</p>";
      boxL.innerHTML = "<p>Digite um valor acima.</p>";
      return;
    }

    // Máquina: Débito + 1..18
    let linhasM = "";
    {
      const te = taxaExtra(EXTRA_MAQUINA, 0);
      const recebe = valor - (valor * (te/100));
      linhasM += linha2("Débito", recebe);
    }
    Object.keys(MAQUINA.credito).map(Number).sort((a,b)=>a-b).forEach(p=>{
      const te = taxaExtra(EXTRA_MAQUINA, p);
      const recebe = valor - (valor * (te/100));
      linhasM += linha2(`${p}x`, recebe);
    });
    boxM.innerHTML = montarTabela2(linhasM);

    // Link: 1..12
    let linhasL = "";
    Object.keys(LINK.credito).map(Number).sort((a,b)=>a-b).forEach(p=>{
      const te = taxaExtra(EXTRA_LINK, p);
      const recebe = valor - (valor * (te/100));
      linhasL += linha2(`${p}x`, recebe);
    });
    boxL.innerHTML = montarTabela2(linhasL);
  }

  // Locks
  function setUnlocked1(v){ v ? localStorage.setItem(ADV_KEY_1,"1") : localStorage.removeItem(ADV_KEY_1); }
  function isUnlocked1(){ return localStorage.getItem(ADV_KEY_1)==="1"; }
  function updateLockUI1(){
    const lockBox = document.getElementById("lockBox");
    const advancedBox = document.getElementById("advancedBox");
    if (isUnlocked1()){
      lockBox.style.display="none";
      advancedBox.style.display="block";
      renderAvancado(lerValor());
    } else {
      lockBox.style.display="block";
      advancedBox.style.display="none";
    }
  }

  function setUnlocked2(v){ v ? localStorage.setItem(ADV_KEY_2,"1") : localStorage.removeItem(ADV_KEY_2); }
  function isUnlocked2(){ return localStorage.getItem(ADV_KEY_2)==="1"; }
  function updateLockUI2(){
    const lockBox2 = document.getElementById("lockBox2");
    const discountBox2 = document.getElementById("discountBox2");
    if (isUnlocked2()){
      lockBox2.style.display="none";
      discountBox2.style.display="block";
      renderDesconto2();
    } else {
      lockBox2.style.display="block";
      discountBox2.style.display="none";
    }
  }

  // Init
  document.addEventListener("DOMContentLoaded", () => {
    document.getElementById("valor").addEventListener("input", atualizar);

    document.getElementById("btnUnlock").addEventListener("click", () => {
      const pin = (document.getElementById("pin").value || "").trim();
      const msg = document.getElementById("lockMsg");
      if (pin === PIN_VALUE){
        msg.textContent = "";
        setUnlocked1(true);
        updateLockUI1();
        document.getElementById("advAccordion").open = true;
      } else {
        msg.textContent = "Senha incorreta.";
      }
    });
    document.getElementById("btnLock").addEventListener("click", () => {
      setUnlocked1(false);
      updateLockUI1();
    });

    document.getElementById("btnUnlock2").addEventListener("click", () => {
      const pin = (document.getElementById("pin2").value || "").trim();
      const msg = document.getElementById("lockMsg2");
      if (pin === PIN_VALUE){
        msg.textContent = "";
        setUnlocked2(true);
        updateLockUI2();
        document.getElementById("discountAccordion").open = true;
      } else {
        msg.textContent = "Senha incorreta.";
      }
    });
    document.getElementById("btnLock2").addEventListener("click", () => {
      setUnlocked2(false);
      updateLockUI2();
    });

    document.getElementById("valor2").addEventListener("input", renderDesconto2);

    updateLockUI1();
    updateLockUI2();
    atualizar();
  });
</script>

</body>
</html>
