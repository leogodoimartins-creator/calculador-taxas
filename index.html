<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ferramentas - Taxas & Troca</title>

  <style>
    body{font-family:Arial,Helvetica,sans-serif;background:#f5f6fa;padding:20px;margin:0}
    .container{max-width:1100px;margin:auto}

    .card{background:white;padding:20px;border-radius:15px;box-shadow:0 8px 20px rgba(0,0,0,0.08);margin-bottom:20px}
    h1{margin:0 0 10px 0}
    p{margin:0 0 16px 0;color:#555;line-height:1.35}
    label{display:block;margin:10px 0 6px 0;font-size:13px;color:#222}
    input, select{width:100%;padding:12px;border-radius:10px;border:1px solid #ddd;font-size:16px;outline:none;background:#fff}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:20px}
    table{width:100%;border-collapse:collapse;margin-top:10px}
    th,td{padding:10px;border-bottom:1px solid #eee;text-align:left;font-size:14px}
    th{background:#eef2ff;color:#1f2a6a}
    .hint{font-size:12px;color:#666;margin-top:8px}
    @media(max-width:900px){.grid{grid-template-columns:1fr}}

    .tabsWrap{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-bottom:16px}
    .tabBtn{
      border:1px solid #e5e7eb;background:#fff;padding:10px 14px;border-radius:999px;
      cursor:pointer;font-weight:700;color:#111827
    }
    .tabBtn.active{background:#2563eb;border-color:#2563eb;color:#fff}

    details.accordion{border:1px solid #e5e7eb;border-radius:14px;overflow:hidden}
    details.accordion > summary{
      list-style:none;cursor:pointer;padding:14px 16px;background:#f9fafb;
      display:flex;align-items:center;justify-content:space-between;font-weight:700
    }
    details.accordion > summary::-webkit-details-marker{display:none}
    .chev{transition:transform .2s ease}
    details[open] .chev{transform:rotate(180deg)}
    .acc-body{padding:16px}
    .btn{width:100%;margin-top:10px;padding:12px;border:0;border-radius:12px;background:#2563eb;color:#fff;font-weight:700;font-size:14px;cursor:pointer}
    .btn-dark{background:#111827}
    .err{margin-top:10px;color:#b91c1c;font-size:13px}
    .hidden{display:none !important;}

    .kpi{padding:14px;border:1px solid #e5e7eb;border-radius:14px;background:#fafafa;margin-top:12px}
    .kpi strong{font-size:20px}
    .breakdown{margin-top:10px;color:#333;font-size:14px;line-height:1.4}
    .checkRow{display:flex;gap:10px;align-items:center;margin-top:10px;flex-wrap:wrap}
    .checkRow input[type="checkbox"]{width:auto;transform:scale(1.1)}
    .pill{display:inline-block;padding:5px 10px;border:1px solid #e5e7eb;border-radius:999px;background:#fff;font-size:12px;color:#111827}
  </style>
</head>

<body>
  <div class="container">

    <div class="tabsWrap">
      <button class="tabBtn active" id="tabCalc">Calculadora</button>
      <button class="tabBtn" id="tabTrade">Troca de Aparelhos</button>
    </div>

    <!-- =========================
         TAB 1: CALCULADORA
    ========================== -->
    <section id="viewCalc">
      <div class="card">
        <h1>Calculadora de Taxas</h1>
        <p>Digite o <strong>valor à vista</strong>. A tabela mostra o <strong>valor final</strong> (com taxa embutida) e a <strong>parcela</strong>.</p>

        <label for="valor">Valor à vista (R$)</label>
        <input type="text" id="valor" placeholder="Ex: 1000 ou 1000,50" />
        <div class="hint">Você pode digitar com vírgula (ex: 1000,50). Não use símbolo R$.</div>
      </div>

      <div class="grid">
        <div class="card">
          <h2 style="margin:0">Máquina Física</h2>
          <div id="maquina" style="margin-top:10px;">Digite um valor acima.</div>
        </div>

        <div class="card">
          <h2 style="margin:0">Link de Pagamento</h2>
          <div id="link" style="margin-top:10px;">Digite um valor acima.</div>
        </div>
      </div>

      <!-- Accordion 1 -->
      <div class="card" style="margin-top:20px;">
        <details class="accordion" id="advAccordion">
          <summary>
            Área Avançada (Valor que recebe após taxa extra) <span class="chev">▾</span>
          </summary>

          <div class="acc-body">
            <p style="margin:0 0 12px;color:#555">
              Aqui mostramos apenas <strong>Parcelas</strong> e <strong>Valor que recebe</strong>,
              calculado como:<br>
              <strong>Valor que recebe</strong> = <em>Valor Final (tabela de cima)</em> − <em>(Valor Final × taxa extra)</em>
            </p>

            <div id="lockBox">
              <label for="pin">Senha</label>
              <input id="pin" type="password" placeholder="Digite a senha" />
              <button class="btn" id="btnUnlock">Desbloquear</button>
              <div class="err" id="lockMsg"></div>
              <div class="hint">Obs: trava visual (site estático).</div>
            </div>

            <div id="advancedBox" style="display:none;margin-top:14px;">
              <div class="grid">
                <div>
                  <h3 style="margin:0 0 8px;font-size:15px;">Máquina Física (valor que recebe)</h3>
                  <div id="maquinaExtra"></div>
                </div>
                <div>
                  <h3 style="margin:0 0 8px;font-size:15px;">Link de Pagamento (valor que recebe)</h3>
                  <div id="linkExtra"></div>
                </div>
              </div>

              <button class="btn btn-dark" id="btnLock">Bloquear</button>
            </div>
          </div>
        </details>
      </div>

      <!-- Accordion 2 -->
      <div class="card" style="margin-top:20px;">
        <details class="accordion" id="discountAccordion">
          <summary>
            Descontar taxas (Máquina + Link) em cima de um valor <span class="chev">▾</span>
          </summary>

          <div class="acc-body">
            <p style="margin:0 0 12px;color:#555">
              Digite um valor abaixo. A tabela calcula quanto você recebe ao <strong>descontar</strong> as taxas
              usando as mesmas porcentagens da taxa extra.<br>
              <strong>Valor que recebe</strong> = <em>Valor digitado</em> − <em>(Valor digitado × taxa%)</em>
            </p>

            <div id="lockBox2">
              <label for="pin2">Senha</label>
              <input id="pin2" type="password" placeholder="Digite a senha" />
              <button class="btn" id="btnUnlock2">Desbloquear</button>
              <div class="err" id="lockMsg2"></div>
              <div class="hint">Obs: trava visual (site estático).</div>
            </div>

            <div id="discountBox2" style="display:none;margin-top:14px;">
              <label for="valor2">Valor (R$)</label>
              <input type="text" id="valor2" placeholder="Ex: 1000 ou 1000,50" />
              <div class="hint">Esse valor é independente do valor à vista de cima.</div>

              <div class="grid" style="margin-top:12px;">
                <div>
                  <h3 style="margin:0 0 8px;font-size:15px;">Máquina (valor que recebe após desconto)</h3>
                  <div id="maquinaDesconto"></div>
                </div>
                <div>
                  <h3 style="margin:0 0 8px;font-size:15px;">Link (valor que recebe após desconto)</h3>
                  <div id="linkDesconto"></div>
                </div>
              </div>

              <button class="btn btn-dark" id="btnLock2">Bloquear</button>
            </div>
          </div>
        </details>
      </div>
    </section>

    <!-- =========================
         TAB 2: TROCA
    ========================== -->
    <section id="viewTrade" class="hidden">
      <div class="card">
        <h1>Troca de Aparelhos</h1>
        <p>
          Selecione o modelo e o armazenamento. O valor é calculado automaticamente.
          <br><span class="pill">GB reais por modelo</span>
          <span class="pill">+R$ 50 se GB &gt; 64 (modelo base64)</span>
          <span class="pill">Bateria em manutenção: −R$ 150 (somente iPhone 13+)</span>
        </p>

        <div class="grid">
          <div>
            <label for="trade_model">Modelo</label>
            <select id="trade_model"></select>
          </div>
          <div>
            <label for="trade_storage">Armazenamento</label>
            <select id="trade_storage"></select>
            <div class="hint" id="trade_storage_hint"></div>
          </div>
        </div>

        <div class="checkRow">
          <input type="checkbox" id="trade_battery" />
          <label for="trade_battery" style="margin:0">Bateria em manutenção (−R$ 150 a partir do iPhone 13)</label>
        </div>

        <div class="kpi">
          <div class="hint">Valor para pagar no aparelho (troca)</div>
          <strong id="trade_price">R$ 0,00</strong>
          <div class="breakdown" id="trade_breakdown"></div>
        </div>

        <div class="hint" style="margin-top:10px;">
          Próxima etapa: avarias/peças (tela, carcaça, câmera, Face ID etc.) com descontos automáticos.
        </div>
      </div>
    </section>

  </div>

<script>
  // =========================
  // TAXAS PRINCIPAIS (calculadora)
  // =========================
  const MAQUINA = {
    debito: 1.30,
    credito: {
      1: 3.69, 2: 5.19, 3: 5.95, 4: 6.70, 5: 7.65, 6: 8.55,
      7: 9.40, 8: 10.30, 9: 11.20, 10: 12.10, 11: 13.10, 12: 13.90,
      13: 15.70, 14: 16.80, 15: 17.90, 16: 18.80, 17: 19.01, 18: 19.90
    }
  };

  const LINK = {
    credito: {
      1: 6.50, 2: 9.55, 3: 10.40, 4: 11.30, 5: 12.20, 6: 13.10,
      7: 14.00, 8: 15.90, 9: 16.80, 10: 17.50, 11: 18.60, 12: 19.50
    }
  };

  // =========================
  // TAXAS EXTRAS (accordions da calculadora)
  // =========================
  const EXTRA_MAQUINA = {
    0: 0.99,
    1: 3.39, 2: 4.40, 3: 5.40, 4: 5.70, 5: 5.80, 6: 5.99,
    7: 7.20, 8: 7.90, 9: 8.40, 10: 8.85, 11: 9.40, 12: 9.85,
    13: 11.40, 14: 11.90, 15: 12.75, 16: 12.80, 17: 12.85, 18: 12.90
  };

  const EXTRA_LINK = {
    1: 3.49, 2: 4.85, 3: 5.45, 4: 6.05, 5: 6.45, 6: 6.95,
    7: 8.00, 8: 8.60, 9: 9.10, 10: 9.40, 11: 10.20, 12: 10.75
  };

  // =========================
  // SENHA (accordions)
  // =========================
  const PIN_VALUE = "358000";
  const ADV_KEY_1 = "adv_unlocked_v2";
  const ADV_KEY_2 = "disc_unlocked_v2";

  // =========================
  // TROCA - MODELOS (GB reais)
  // =========================
  const TRADE_MODELS = [
    // Preços seus (base) + GB oficiais do modelo
    { id:"XR", name:"iPhone XR", type:"base64", base:200, minGen:10, storages:[64,128,256] },
    { id:"XS", name:"iPhone XS", type:"base64", base:200, minGen:10, storages:[64,256,512] },
    { id:"XS_MAX", name:"iPhone XS Max", type:"base64", base:300, minGen:10, storages:[64,256,512] },

    { id:"11", name:"iPhone 11", type:"base64", base:450, minGen:11, storages:[64,128,256] },
    { id:"11_PRO", name:"iPhone 11 Pro", type:"base64", base:650, minGen:11, storages:[64,256,512] },
    { id:"11_PRO_MAX", name:"iPhone 11 Pro Max", type:"base64", base:750, minGen:11, storages:[64,256,512] },

    { id:"12", name:"iPhone 12", type:"base64", base:700, minGen:12, storages:[64,128,256] },
    { id:"12_PRO", name:"iPhone 12 Pro", type:"base64", base:900, minGen:12, storages:[128,256,512] },
    { id:"12_PRO_MAX", name:"iPhone 12 Pro Max", type:"base64", base:1200, minGen:12, storages:[128,256,512] },

    { id:"13", name:"iPhone 13", type:"base64", base:1400, minGen:13, storages:[128,256,512] },
    { id:"13_PRO", name:"iPhone 13 Pro", type:"base64", base:1700, minGen:13, storages:[128,256,512,1024] },
    { id:"13_PRO_MAX", name:"iPhone 13 Pro Max", type:"base64", base:1900, minGen:13, storages:[128,256,512,1024] },

    { id:"14", name:"iPhone 14", type:"base64", base:1700, minGen:14, storages:[128,256,512] },
    { id:"14_PRO", name:"iPhone 14 Pro", type:"base64", base:2400, minGen:14, storages:[128,256,512,1024] },
    { id:"14_PRO_MAX", name:"iPhone 14 Pro Max", type:"base64", base:2850, minGen:14, storages:[128,256,512,1024] },

    { id:"15", name:"iPhone 15", type:"base64", base:2350, minGen:15, storages:[128,256,512] },

    // Modelos com preço fixo por GB (somente onde você cadastrou preço)
    { id:"15_PRO", name:"iPhone 15 Pro", type:"fixedByGB", minGen:15, prices:{128:2750,256:2950} },
    { id:"15_PRO_MAX", name:"iPhone 15 Pro Max", type:"fixedByGB", minGen:15, prices:{256:3900,512:4100} },

    { id:"16", name:"iPhone 16", type:"fixedByGB", minGen:16, prices:{128:3400,256:3500} },
    { id:"16_PRO", name:"iPhone 16 Pro", type:"fixedByGB", minGen:16, prices:{128:4100,256:4250} },
    { id:"16_PRO_MAX", name:"iPhone 16 Pro Max", type:"fixedByGB", minGen:16, prices:{256:5000,512:5200} }
  ];

  // =========================
  // HELPERS
  // =========================
  function formatar(v){
    return v.toLocaleString("pt-BR",{style:"currency",currency:"BRL"});
  }

  function parseBRL(raw) {
    const t = (raw || "").trim();
    if (!t) return null;
    const normalizado = t.replace(/\./g, "").replace(",", ".");
    const v = Number(normalizado);
    return Number.isFinite(v) ? v : null;
  }

  function lerValor() { return parseBRL(document.getElementById("valor").value); }
  function lerValor2() { return parseBRL(document.getElementById("valor2").value); }

  function valorFinalEmbutido(valorAvista, taxaPercent){
    const t = taxaPercent / 100;
    return valorAvista / (1 - t);
  }

  function montarTabela4(linhasHtml){
    return `
      <table>
        <thead>
          <tr>
            <th>Parcelas</th>
            <th>Taxa</th>
            <th>Valor Final</th>
            <th>Parcela</th>
          </tr>
        </thead>
        <tbody>${linhasHtml}</tbody>
      </table>
    `;
  }

  function linha4(parcelasLabel, taxaPercent, valorFinal, parcela){
    const parcelaTxt = parcela == null ? "-" : formatar(parcela);
    return `
      <tr>
        <td>${parcelasLabel}</td>
        <td>${taxaPercent.toFixed(2)}%</td>
        <td>${formatar(valorFinal)}</td>
        <td>${parcelaTxt}</td>
      </tr>
    `;
  }

  function montarTabela2(linhasHtml){
    return `
      <table>
        <thead>
          <tr>
            <th>Parcelas</th>
            <th>Valor que recebe</th>
          </tr>
        </thead>
        <tbody>${linhasHtml}</tbody>
      </table>
    `;
  }

  function linha2(parcelasLabel, valorRecebe){
    return `
      <tr>
        <td>${parcelasLabel}</td>
        <td><strong>${formatar(valorRecebe)}</strong></td>
      </tr>
    `;
  }

  function taxaExtra(obj, key){
    const v = obj[key];
    return (typeof v === "number" && isFinite(v)) ? v : 0;
  }

  // =========================
  // TABS
  // =========================
  function showTab(which){
    const calcBtn = document.getElementById("tabCalc");
    const tradeBtn = document.getElementById("tabTrade");
    const calcView = document.getElementById("viewCalc");
    const tradeView = document.getElementById("viewTrade");

    if (which === "calc"){
      calcBtn.classList.add("active");
      tradeBtn.classList.remove("active");
      calcView.classList.remove("hidden");
      tradeView.classList.add("hidden");
    } else {
      tradeBtn.classList.add("active");
      calcBtn.classList.remove("active");
      tradeView.classList.remove("hidden");
      calcView.classList.add("hidden");
    }
  }

  // =========================
  // CALCULADORA (tab 1)
  // =========================
  function atualizar(){
    const alvoMaquina = document.getElementById("maquina");
    const alvoLink = document.getElementById("link");
    const valor = lerValor();

    if (!valor || valor <= 0){
      alvoMaquina.innerHTML = "Digite um valor acima.";
      alvoLink.innerHTML = "Digite um valor acima.";
      renderAvancado(null);
      return;
    }

    let linhasM = "";
    const vfDeb = valorFinalEmbutido(valor, MAQUINA.debito);
    linhasM += linha4("Débito", MAQUINA.debito, vfDeb, null);

    Object.keys(MAQUINA.credito).map(Number).sort((a,b)=>a-b).forEach(p=>{
      const taxa = MAQUINA.credito[p];
      const vf = valorFinalEmbutido(valor, taxa);
      const parc = vf / p;
      linhasM += linha4(`${p}x`, taxa, vf, parc);
    });
    alvoMaquina.innerHTML = montarTabela4(linhasM);

    let linhasL = "";
    Object.keys(LINK.credito).map(Number).sort((a,b)=>a-b).forEach(p=>{
      const taxa = LINK.credito[p];
      const vf = valorFinalEmbutido(valor, taxa);
      const parc = vf / p;
      linhasL += linha4(`${p}x`, taxa, vf, parc);
    });
    alvoLink.innerHTML = montarTabela4(linhasL);

    renderAvancado(valor);
  }

  // Accordion 1
  function renderAvancado(valorAvista){
    const boxM = document.getElementById("maquinaExtra");
    const boxL = document.getElementById("linkExtra");
    if (!isUnlocked1()) return;

    if (!valorAvista){
      boxM.innerHTML = "<p>Digite um valor acima.</p>";
      boxL.innerHTML = "<p>Digite um valor acima.</p>";
      return;
    }

    let linhasM = "";
    {
      const vf = valorFinalEmbutido(valorAvista, MAQUINA.debito);
      const te = taxaExtra(EXTRA_MAQUINA, 0);
      const recebe = vf - (vf * (te/100));
      linhasM += linha2("Débito", recebe);
    }
    Object.keys(MAQUINA.credito).map(Number).sort((a,b)=>a-b).forEach(p=>{
      const vf = valorFinalEmbutido(valorAvista, MAQUINA.credito[p]);
      const te = taxaExtra(EXTRA_MAQUINA, p);
      const recebe = vf - (vf * (te/100));
      linhasM += linha2(`${p}x`, recebe);
    });
    boxM.innerHTML = montarTabela2(linhasM);

    let linhasL = "";
    Object.keys(LINK.credito).map(Number).sort((a,b)=>a-b).forEach(p=>{
      const vf = valorFinalEmbutido(valorAvista, LINK.credito[p]);
      const te = taxaExtra(EXTRA_LINK, p);
      const recebe = vf - (vf * (te/100));
      linhasL += linha2(`${p}x`, recebe);
    });
    boxL.innerHTML = montarTabela2(linhasL);
  }

  // Accordion 2
  function renderDesconto2(){
    if (!isUnlocked2()) return;

    const valor = lerValor2();
    const boxM = document.getElementById("maquinaDesconto");
    const boxL = document.getElementById("linkDesconto");

    if (!valor || valor <= 0){
      boxM.innerHTML = "<p>Digite um valor acima.</p>";
      boxL.innerHTML = "<p>Digite um valor acima.</p>";
      return;
    }

    let linhasM = "";
    {
      const te = taxaExtra(EXTRA_MAQUINA, 0);
      const recebe = valor - (valor * (te/100));
      linhasM += linha2("Débito", recebe);
    }
    Object.keys(MAQUINA.credito).map(Number).sort((a,b)=>a-b).forEach(p=>{
      const te = taxaExtra(EXTRA_MAQUINA, p);
      const recebe = valor - (valor * (te/100));
      linhasM += linha2(`${p}x`, recebe);
    });
    boxM.innerHTML = montarTabela2(linhasM);

    let linhasL = "";
    Object.keys(LINK.credito).map(Number).sort((a,b)=>a-b).forEach(p=>{
      const te = taxaExtra(EXTRA_LINK, p);
      const recebe = valor - (valor * (te/100));
      linhasL += linha2(`${p}x`, recebe);
    });
    boxL.innerHTML = montarTabela2(linhasL);
  }

  // Locks
  function setUnlocked1(v){ v ? localStorage.setItem(ADV_KEY_1,"1") : localStorage.removeItem(ADV_KEY_1); }
  function isUnlocked1(){ return localStorage.getItem(ADV_KEY_1)==="1"; }
  function updateLockUI1(){
    const lockBox = document.getElementById("lockBox");
    const advancedBox = document.getElementById("advancedBox");
    if (isUnlocked1()){
      lockBox.style.display="none";
      advancedBox.style.display="block";
      renderAvancado(lerValor());
    } else {
      lockBox.style.display="block";
      advancedBox.style.display="none";
    }
  }

  function setUnlocked2(v){ v ? localStorage.setItem(ADV_KEY_2,"1") : localStorage.removeItem(ADV_KEY_2); }
  function isUnlocked2(){ return localStorage.getItem(ADV_KEY_2)==="1"; }
  function updateLockUI2(){
    const lockBox2 = document.getElementById("lockBox2");
    const discountBox2 = document.getElementById("discountBox2");
    if (isUnlocked2()){
      lockBox2.style.display="none";
      discountBox2.style.display="block";
      renderDesconto2();
    } else {
      lockBox2.style.display="block";
      discountBox2.style.display="none";
    }
  }

  // =========================
  // TROCA (tab 2)
  // =========================
  function populateTradeModels(){
    const sel = document.getElementById("trade_model");
    sel.innerHTML = "";
    for (const m of TRADE_MODELS){
      const opt = document.createElement("option");
      opt.value = m.id;
      opt.textContent = m.name;
      sel.appendChild(opt);
    }
  }

  function getModelById(id){
    return TRADE_MODELS.find(m => m.id === id) || TRADE_MODELS[0];
  }

  function populateStorageForModel(model){
    const storageSel = document.getElementById("trade_storage");
    const hint = document.getElementById("trade_storage_hint");
    storageSel.innerHTML = "";

    let storages = [];

    if (model.type === "fixedByGB"){
      storages = Object.keys(model.prices).map(Number).sort((a,b)=>a-b);
      hint.textContent = "Preço fixo por GB (somente GB com valor cadastrado).";
    } else {
      storages = (model.storages || [128,256,512]).slice().sort((a,b)=>a-b);
      hint.textContent = "Modelo base64: se GB > 64, soma +R$ 50 no valor pago.";
    }

    for (const s of storages){
      const opt = document.createElement("option");
      opt.value = String(s);
      opt.textContent = (s === 1024) ? "1TB" : `${s}GB`;
      storageSel.appendChild(opt);
    }
  }

  function calcTradePrice(){
    const modelId = document.getElementById("trade_model").value;
    const storage = Number(document.getElementById("trade_storage").value);
    const batteryMaint = document.getElementById("trade_battery").checked;

    const model = getModelById(modelId);

    let base = 0;
    let addStorage = 0;
    let batteryDiscount = 0;
    let note = "";

    if (model.type === "fixedByGB"){
      base = model.prices[storage] || 0;
      note = "Preço fixo por GB";
    } else {
      base = model.base;
      if (storage && storage > 64){
        addStorage = 50;
      }
      note = "Base 64GB (+50 se >64GB)";
    }

    if (batteryMaint && model.minGen >= 13){
      batteryDiscount = 150;
    }

    const finalPrice = Math.max(0, base + addStorage - batteryDiscount);

    document.getElementById("trade_price").textContent = formatar(finalPrice);

    const storageLabel = (storage === 1024) ? "1TB" : `${storage}GB`;

    const breakdownLines = [];
    breakdownLines.push(`Modelo: ${model.name}`);
    breakdownLines.push(`Armazenamento: ${storageLabel}`);
    breakdownLines.push(`Regra: ${note}`);
    breakdownLines.push(`Base: ${formatar(base)}`);
    if (addStorage > 0) breakdownLines.push(`+ Extra GB: ${formatar(addStorage)}`);
    if (batteryMaint){
      if (model.minGen >= 13) breakdownLines.push(`− Bateria em manutenção: ${formatar(batteryDiscount)}`);
      else breakdownLines.push(`Bateria em manutenção: (não aplica desconto para este modelo)`);
    }
    breakdownLines.push(`————————————`);
    breakdownLines.push(`Valor final para pagar: ${formatar(finalPrice)}`);

    document.getElementById("trade_breakdown").innerHTML = breakdownLines.join("<br>");
  }

  // =========================
  // INIT
  // =========================
  document.addEventListener("DOMContentLoaded", () => {
    // Tabs
    document.getElementById("tabCalc").addEventListener("click", ()=>showTab("calc"));
    document.getElementById("tabTrade").addEventListener("click", ()=>showTab("trade"));

    // Calculadora
    document.getElementById("valor").addEventListener("input", atualizar);

    document.getElementById("btnUnlock").addEventListener("click", () => {
      const pin = (document.getElementById("pin").value || "").trim();
      const msg = document.getElementById("lockMsg");
      if (pin === PIN_VALUE){
        msg.textContent = "";
        setUnlocked1(true);
        updateLockUI1();
        document.getElementById("advAccordion").open = true;
      } else msg.textContent = "Senha incorreta.";
    });
    document.getElementById("btnLock").addEventListener("click", () => { setUnlocked1(false); updateLockUI1(); });

    document.getElementById("btnUnlock2").addEventListener("click", () => {
      const pin = (document.getElementById("pin2").value || "").trim();
      const msg = document.getElementById("lockMsg2");
      if (pin === PIN_VALUE){
        msg.textContent = "";
        setUnlocked2(true);
        updateLockUI2();
        document.getElementById("discountAccordion").open = true;
      } else msg.textContent = "Senha incorreta.";
    });
    document.getElementById("btnLock2").addEventListener("click", () => { setUnlocked2(false); updateLockUI2(); });

    document.getElementById("valor2").addEventListener("input", renderDesconto2);

    // Troca
    populateTradeModels();
    const modelSel = document.getElementById("trade_model");
    const storageSel = document.getElementById("trade_storage");
    const batterySel = document.getElementById("trade_battery");

    populateStorageForModel(getModelById(modelSel.value));
    calcTradePrice();

    modelSel.addEventListener("change", () => {
      const m = getModelById(modelSel.value);
      populateStorageForModel(m);
      calcTradePrice();
    });
    storageSel.addEventListener("change", calcTradePrice);
    batterySel.addEventListener("change", calcTradePrice);

    // Inicial
    showTab("calc");
    updateLockUI1();
    updateLockUI2();
    atualizar();
  });
</script>

</body>
</html>
